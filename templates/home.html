{% extends "base.html" %}
{% load static %}

{% block title %}Decoraciones Mori{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block content %}

<!-- Sección Hero -->
<section class="hero-section position-relative p-0 m-0">
   {% if carousel_images %}
   <div id="heroCarousel" class="carousel slide carousel-fade vh-100" data-bs-ride="carousel" data-bs-interval="5000">
        <!-- Indicadores mejorados -->
        <div class="carousel-indicators">
            {% for image in carousel_images %}
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="{{ forloop.counter0 }}" 
                    {% if forloop.first %}class="active" aria-current="true"{% endif %} 
                    aria-label="Slide {{ forloop.counter }}"
                    style="width: 12px; height: 12px; border-radius: 50%; margin: 0 5px; border: 2px solid rgba(255,255,255,0.8);"></button>
            {% endfor %}
        </div>

        <!-- Slides -->
        <div class="carousel-inner h-100">
            {% for image in carousel_images %}
            <div class="carousel-item h-100 {% if forloop.first %}active{% endif %}">
                <!-- Imagen de fondo optimizada -->
                <div class="position-absolute top-0 start-0 w-100 h-100 overflow-hidden">
                    <img src="{{ image.image.url }}" 
                         class="w-100 h-100" 
                         alt="{{ image.title }}" 
                         style="object-fit: cover; object-position: center; filter: brightness(1.1) contrast(1.05);">
                </div>

                <!-- Contenido solo texto sin fondos -->
                <div class="d-flex align-items-center justify-content-center h-100 text-center">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8 col-md-10">
                                <h1 class="display-3 fw-bold mb-4 text-white animate__animated animate__fadeInUp" 
                                    style="letter-spacing: -0.02em;">
                                    {{ image.title }}
                                </h1>
                                {% if image.subtitle %}
                                <p class="lead mb-4 text-white fs-4 animate__animated animate__fadeInUp animate__delay-1s">
                                    {{ image.subtitle }}
                                </p>
                                {% endif %}
                                {% if image.button_text and image.button_url %}
                                <div class="mt-4 animate__animated animate__fadeInUp animate__delay-2s">
                                    <a href="{{ image.button_url }}" 
                                       class="btn btn-primary btn-lg px-5 py-3 fw-semibold"
                                       style="border-radius: 50px; transition: all 0.3s ease; text-decoration: none;"
                                       onmouseover="this.style.transform='translateY(-2px)'"
                                       onmouseout="this.style.transform='translateY(0)'">
                                        <span class="me-2">{{ image.button_text }}</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Controles mejorados -->
        <button class="carousel-control-prev position-absolute top-50 start-0 translate-middle-y ms-3" 
                type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"
                style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; border: none; backdrop-filter: blur(10px); transition: all 0.3s ease;"
                onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.1)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
            <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next position-absolute top-50 end-0 translate-middle-y me-3" 
                type="button" data-bs-target="#heroCarousel" data-bs-slide="next"
                style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; border: none; backdrop-filter: blur(10px); transition: all 0.3s ease;"
                onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.1)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
            <span class="carousel-control-next-icon" aria-hidden="true" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));"></span>
            <span class="visually-hidden">Siguiente</span>
        </button>

        <!-- Indicador de scroll hacia abajo -->
        <div class="position-absolute bottom-0 start-50 translate-middle-x mb-4">
            <div class="scroll-indicator animate__animated animate__bounce animate__infinite animate__slow">
                <i class="fas fa-chevron-down text-white fs-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Carrusel por defecto mejorado -->
    <div class="hero-section vh-100 d-flex align-items-center justify-content-center position-relative" 
         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container text-center text-white">
            <div class="hero-content p-5 rounded-4" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                <h1 class="display-2 fw-bold mb-4" style="letter-spacing: -0.02em;">
                    {% if site_settings %}{{ site_settings.site_name }}{% else %}Decoraciones Mori{% endif %}
                </h1>
                <p class="lead fs-3 mb-5">Empresa dedicada a servicios de limpieza, desinfección e instalaciones.</p>
                <a href="{% url 'services:service_list' %}" 
                   class="btn btn-light btn-lg px-5 py-3 fw-semibold"
                   style="border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    Ver Servicios
                    <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</section>

<!-- Sección de Resumen de Servicios -->
<section class="services-overview py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title lead">Categorías de Servicios</h2>
                <p class="section-subtitle lead">Explora nuestras diferentes categorías de servicios</p>
            </div>
        </div>
        
        <div class="row lead">
            {% for item in categories_with_service %}
            <div class="col-md-4 mb-4">
                <div class="card service-card h-100">
                    {% with featured_image=item.service.get_featured_image %}
                        {# Contenedor para mantener altura y estilo consistentes con tu CSS (.service-card img { height: 220px; }) #}
                        <div class="card-img-top-container" style="height: 220px; overflow: hidden; background-color: #eee; border-top-left-radius: 0.8rem; border-top-right-radius: 0.8rem;">
                            {% if featured_image %}
                                {% if featured_image.image_url %}
                                    {# Renderizar el embed code (iframe) #}
                                    {{ featured_image.image_url|safe }}
                                {% elif featured_image.image %}
                                    {# Renderizar la imagen subida #}
                                    <img src="{{ featured_image.image.url }}" class="card-img-top" alt="{{ item.category.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                    {# Placeholder por defecto si featured_image existe pero no tiene fuente #}
                                    <img src="{% static 'imagen/default-service.jpg' %}" class="card-img-top" alt="{{ item.category.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% endif %}
                            {% else %}
                                {# Placeholder por defecto si get_featured_image devolvió None #}
                                 <img src="{% static 'imagen/default-service.jpg' %}" class="card-img-top" alt="{{ item.category.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% endif %}
                        </div>
                    {% endwith %}
                    <div class="card-body">
                        <h5 class="card-title">{{ item.category.name }}</h5>
                        <p class="card-text">{{ item.category.description }}</p>
                        {% if item.service %} {# Comprobación por si acaso item.service fuera None #}
                        <p style="color: #007bff;">Servicio destacado: {{ item.service.name }}</p>
                        {% endif %}
                        <a href="{% url 'services:category' item.category.id %}" class="btn btn-primary">Ver categoría</a>
                    </div>
                </div>
            </div>
            {% empty %}
             <div class="col-12">
                 <p class="text-center">No hay categorías de servicio para mostrar.</p>
             </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{% url 'services:service_list' %}" class="btn btn-primary">Ver todos los servicios</a>
        </div>
    </div>
</section>

<!-- Sección ¿Por qué elegirnos? -->
<section class="why-choose-us py-5 bg-light">
    <div class="container lead">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">¿Por qué elegirnos?</h2>
                <p class="section-subtitle lead">Nos destacamos por la calidad y profesionalismo, En nuestra tienda, nos comprometemos a brindar soluciones confiables, eficientes y personalizadas que se adaptan a las necesidades de cada cliente. Contamos con un equipo altamente capacitado, materiales de primera calidad y una atención al cliente cercana y transparente. Elegirnos es optar por excelencia, puntualidad y resultados garantizados.</p>
            </div>  
        </div>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="feature-box text-center">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-medal fa-3x text-primary"></i>
                    </div>
                    <h4 class="section-title">Calidad Garantizada</h4>
                    <p class="lead">Utilizamos los mejores materiales y técnicas para garantizar resultados excepcionales.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-box text-center">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-user-tie fa-3x text-primary"></i>
                    </div>
                    <h4 class="section-title">Personal Capacitado</h4>
                    <p class="lead">Nuestro equipo está formado por profesionales con amplia experiencia en el sector.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-box text-center">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-clock fa-3x text-primary"></i>
                    </div>
                    <h4 class="section-title">Puntualidad y Eficiencia</h4>
                    <p class="lead">Cumplimos con los plazos establecidos y optimizamos nuestros procesos para ser eficientes.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section py-5 bg-primary text-white text-center">
    <div class="container lead">
        <h2 class="mb-4">¿Listo para transformar tu espacio?</h2>
        <p class="mb-4">Contáctanos ahora y recibe una cotización personalizada para tus necesidades.</p>
        <a href="{% url 'services:contacto' %}" class="btn btn-light btn-lg">Contáctanos Ahora</a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/scripts.js' %}"></script>
{% endblock %}